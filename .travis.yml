language: node_js
node_js:
- 8

sudo: required

os:
- osx

addons:
  chrome: stable

before_script:
- export DISPLAY=:99.0

install:
- yarn install

cache:
  yarn: true

jobs:
  include:
  - stage: test + build
    if: branch != master
    script:
    - yarn test
    - ng lint
    - yarn build:prod
  - stage: build + deploy osx
    if: branch = master
    os:
    - osx
    script:
    - yarn electron:mac
    deploy:
      provider: releases
      api_key:
        secure: nHpK13Hy+CquZ6rMiQ5uKsCnvcK1l/elPU1WLLQP79LWhsQV24kyd6JT0Y6qq4V+s4dZQxPZ0wWIYIqByweCLhqzvE9RlPyxp2Vz3l7lFGX79a9Pb+6Y1sEY8dCe/Mj2BJKz3EoK5guYxYYAK/TmBIDxRYhvrZagPM9QONSOf7tovMAanBVSb/FazvIhTziV2ptep6sd24MbqWK4Ccw7Imj4KOv/4FJzwgtVnaT0LQFG9C2CJlTplcmPkelGilrGHKLdo5YpIekzEkioI2S43CI60VBffUhmOUEMWIFURt9v/Kphs1QigKBAL7pjjoprSkJ0ZAdXUJSoYWEjLDo8jUfN2y3dXRHHaVYyZDSdIxyZvmZmNutgg0D08au1nlPvkVNiLQ5nlDr0NPXWeX3XwgYwyBihJfeS7K1ZiIvCFvi96ln2BOpZEXl4xMJMQpMFQtqBObKaTUZptirULOGumLRWp7msTx/fLBLNrvHA6VJDJ/D29sX5RXIFZL1NMjLRiKIBuw8GW1caKtj+Jz6zs67M6R3KxiXVTH12sJEgMdVBSwvB2AqlaSxFL8ha6wbQTrXbyeltqdz1fqcmaWTr6M7LpZCk0sCKfXqL+ypFEEam3xqhzE/oNtVKWhoHoZ5EIvEIdQ9qj24oMFeUYsMIEUxQu0nTfgp4s7274bWeJ6s=
      file: release/Simplicate Time Tracker.dmg
      on:
        tags: false
  - stage: build + deploy win
    if: branch = master
    os:
    - windows
    script: yarn electron:windows
    deploy:
      provider: releases
      api_key:
        secure: nHpK13Hy+CquZ6rMiQ5uKsCnvcK1l/elPU1WLLQP79LWhsQV24kyd6JT0Y6qq4V+s4dZQxPZ0wWIYIqByweCLhqzvE9RlPyxp2Vz3l7lFGX79a9Pb+6Y1sEY8dCe/Mj2BJKz3EoK5guYxYYAK/TmBIDxRYhvrZagPM9QONSOf7tovMAanBVSb/FazvIhTziV2ptep6sd24MbqWK4Ccw7Imj4KOv/4FJzwgtVnaT0LQFG9C2CJlTplcmPkelGilrGHKLdo5YpIekzEkioI2S43CI60VBffUhmOUEMWIFURt9v/Kphs1QigKBAL7pjjoprSkJ0ZAdXUJSoYWEjLDo8jUfN2y3dXRHHaVYyZDSdIxyZvmZmNutgg0D08au1nlPvkVNiLQ5nlDr0NPXWeX3XwgYwyBihJfeS7K1ZiIvCFvi96ln2BOpZEXl4xMJMQpMFQtqBObKaTUZptirULOGumLRWp7msTx/fLBLNrvHA6VJDJ/D29sX5RXIFZL1NMjLRiKIBuw8GW1caKtj+Jz6zs67M6R3KxiXVTH12sJEgMdVBSwvB2AqlaSxFL8ha6wbQTrXbyeltqdz1fqcmaWTr6M7LpZCk0sCKfXqL+ypFEEam3xqhzE/oNtVKWhoHoZ5EIvEIdQ9qj24oMFeUYsMIEUxQu0nTfgp4s7274bWeJ6s=
      file: release/Simplicate Time Tracker.exe
      on:
        tags: false

